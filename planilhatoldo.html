<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLACAS E FAIXADAS</title>

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="stylesheet" href="./stylegeral.css">
    <link rel="stylesheet" href="./stylePeF.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>

    <!-- Helper para IndexedDB (1 kB) -->
    <script src="https://cdn.jsdelivr.net/npm/idb-keyval@6/dist/umd.js"></script>
    <!-- bibliotecas necessárias -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4/dist/exceljs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2/dist/FileSaver.min.js"></script>

    <!-- script com a função -->
    <script src="scriptPeF.js"></script>

    <!-- Input oculto para importar Excel -->
    <input type="file" id="importExcelInput" accept=".xlsx" style="display: none;"
        onchange="importarExcelOtimizado(this.files[0])">

    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <!-- GitHub Pages Info -->
    <div class="github-info">
        <a href="./index.html" class="logo">AS INFORMATICA</a>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel">
        <h4><i class="fas fa-cog"></i> Gerenciar Produtos</h4>
        <button class="btn-primary" onclick="showAddProductModal()">
            <i class="fas fa-plus"></i> Adicionar Produto
        </button>
        <button class="btn-success" onclick="showImportModal()">
            <i class="fas fa-upload"></i> Importar CSV
        </button>
        <button class="btn-info" onclick="exportProducts()">
            <i class="fas fa-download"></i> Exportar CSV
        </button>
        <button class="btn-warning" onclick="resetProducts()">
            <i class="fas fa-undo"></i> Resetar Produtos
        </button>

        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);">
            <label style="font-size: 12px; font-weight: bold; display: block; margin-bottom: 5px;">
                <i class="fas fa-filter"></i> Categoria:
            </label>
            <select id="categoryFilter" onchange="filterByCategory()" style="margin-bottom: 10px;">
                <option value="">Todas</option>
            </select>

            <label style="font-size: 12px; font-weight: bold; display: block; margin-bottom: 5px;">
                <i class="fas fa-search"></i> Buscar:
            </label>
            <input type="text" id="searchInput" placeholder="Buscar produto (nome)..." onkeyup="searchProducts()"
                style="margin-bottom: 15px;">
        </div>

        <div
            style="position: relative; top: -4%; transform: translate(0%, 50%); display: flex; justify-content: flex-end; align-items: center; gap: 5px;">
            <button style="height: 20px; width: 49%; justify-content: center;" class="btn-success"
                onclick="exportarExcelCompleto()">
                <i class="fas fa-file-excel"></i>
            </button>

            <button style="height: 20px; width: 49%;" class="action-button btn-load"
                onclick="document.getElementById('importExcelInput').click()" title="Carregar Orçamento">
                <i class="fas fa-folder-open"></i>
            </button>
        </div>

        <button style="height: 20px; width: 100%; justify-content: center;" class="btn-info"
            onclick="imprimirExcelCompleto()">
            <i class="fas fa-print"></i> IMPRIMIR
        </button>

        <button style="height: 20px; width: 100%; justify-content: center;" class="btn-success"
            onclick="showCalculatorModal()" style="margin-top: 10px;">
            <i class="fas fa-calculator"></i> Calculadora
        </button>

        <button id="btnInstrucoes" type="button"
            style="font-size: 18px; position: relative; left: 50%; transform: translateX(-50%); height: 50px; width: 100%; justify-content: center;"
            title="instruções">
            instruções
        </button>
    </div>
    </div>

    <div class="barratopo"></div>

    <div id="paginas-container"></div>
    <div class="barra-inferior" id="barra-inferior"></div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Adicionar Novo Produto</h3>
                <span class="close" onclick="closeModal('addProductModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="productCode"><i class="fas fa-barcode"></i> Código:</label>
                <input type="text" id="productCode" required placeholder="Digite o código do produto">
            </div>
            <div class="form-group">
                <label for="productName"><i class="fas fa-tag"></i> Nome:</label>
                <input type="text" id="productName" required placeholder="Digite o nome do produto">
            </div>
            <div class="form-group">
                <label for="productCategory"><i class="fas fa-folder"></i> Categoria:</label>
                <select id="productCategory">
                    <option value="ESTRUTURA METALICA">ESTRUTURA METALICA</option>
                    <option value="LONAS E ADESIVOS">LONAS E ADESIVOS</option>
                    <option value="ACM FUNDO">ACM FUNDO</option>
                    <option value="PVC">PVC</option>
                    <option value="ILUMINAÇÃO">ILUMINAÇÃO</option>
                    <option value="MDF">MDF</option>
                    <option value="PINTURA">PINTURA</option>
                    <option value="MÃO DE OBRA">MÃO DE OBRA</option>
                </select>
            </div>
            <div class="form-group">
                <label for="productPrice"><i class="fas fa-dollar-sign"></i> Preço:</label>
                <input type="number" id="productPrice" step="0.01" required placeholder="0.00">
            </div>
            <div class="form-group">
                <label for="productUnit"><i class="fas fa-ruler"></i> Unidade:</label>
                <input type="text" id="productUnit" value="UNID" placeholder="UNID, M, M², etc.">
            </div>
            <div class="form-group">
                <label for="productFormula"><i class="fas fa-calculator"></i> Fórmula:</label>
                <input type="text" id="productFormula" value="Q * $" placeholder="Q * $, C * A * Q * $, etc.">
                <small>Use: Q=Quantidade, $=Preço, C=Comprimento, A=Largura</small>
            </div>
            <div class="btn-group">
                <button class="btn-primary" onclick="addProduct()">
                    <i class="fas fa-check"></i> Adicionar
                </button>
                <button class="btn-warning" onclick="closeModal('addProductModal')">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-import"></i> Importar Produtos (CSV)</h3>
                <span class="close" onclick="closeModal('importModal')">&times;</span>
            </div>
            <div class="form-group">
                <label for="csvFile"><i class="fas fa-file-csv"></i> Arquivo CSV:</label>
                <input type="file" id="csvFile" accept=".csv" onchange="handleFileSelect(event)">
                <small>O arquivo deve conter: código, nome, preco, formula, unidade, categoria</small>
            </div>
            <div class="form-group">
                <label><i class="fas fa-paste"></i> Ou cole o conteúdo CSV:</label>
                <textarea id="csvContent" rows="10" style="width: 100%; font-family: monospace; resize: vertical;"
                    placeholder="codigo,nome,preco,formula,unidade,categoria
PROD001,Produto Exemplo,10.50,Q * $,UNID,ESTRUTURA METALICA"></textarea>
            </div>
            <div class="btn-group">
                <button class="btn-success" onclick="importFromText()">
                    <i class="fas fa-upload"></i> Importar
                </button>
                <button class="btn-warning" onclick="closeModal('importModal')">
                    <i class="fas fa-times"></i> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Calculadora Modal -->
    <div id="calculatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calculator"></i> Calculadora</h3>
                <span class="close" onclick="closeModal('calculatorModal')">&times;</span>
            </div>
            <div class="form-group">
                <label>Display:</label>
                <input type="text" id="calcDisplay" readonly style="text-align: right; font-size: 18px;">
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                <button onclick="calcClear()" class="btn-warning">C</button>
                <button onclick="calcAppend('/')" class="btn-info">/</button>
                <button onclick="calcAppend('*')" class="btn-info">*</button>
                <button onclick="calcDelete()" class="btn-danger">⌫</button>

                <button onclick="calcAppend('7')">7</button>
                <button onclick="calcAppend('8')">8</button>
                <button onclick="calcAppend('9')">9</button>
                <button onclick="calcAppend('-')" class="btn-info">-</button>

                <button onclick="calcAppend('4')">4</button>
                <button onclick="calcAppend('5')">5</button>
                <button onclick="calcAppend('6')">6</button>
                <button onclick="calcAppend('+')" class="btn-info">+</button>

                <button onclick="calcAppend('1')">1</button>
                <button onclick="calcAppend('2')">2</button>
                <button onclick="calcAppend('3')">3</button>
                <button onclick="calcCalculate()" class="btn-success" style="grid-row: span 2;">=</button>

                <button onclick="calcAppend('0')" style="grid-column: span 2;">0</button>
                <button onclick="calcAppend('.')">.</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

</body>

</html>