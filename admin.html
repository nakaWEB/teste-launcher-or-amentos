<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administração - AS INFORMATICA</title>
    <link rel="stylesheet" href="./stylegeral.css">
    <style>
        .admin-container {
            margin: 20px auto;
            max-width: 1200px;
            padding: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #f8f9fa;
            color: #333;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: #007bff;
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .users-table {
            width: 100%;
            margin-top: 20px;
        }

        .users-table th, .users-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .users-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .logs-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }

        .log-entry.edicao {
            border-left-color: #ffc107;
        }

        .log-entry.exclusao {
            border-left-color: #dc3545;
        }

        .btn-primary {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn-logout {
            background: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Verificação de ADM -->
    <script src="auth.js"></script>
    <script>
        if (!verificarADM()) {
            window.location.href = 'placas-fachadas.html';
        }
    </script>

    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-cogs"></i> Painel de Administração</h1>
            <button class="btn-logout" onclick="fazerLogout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>

        <div class="admin-tabs">
            <button class="tab-button active" onclick="mudarAba('usuarios')">
                <i class="fas fa-users"></i> Usuários
            </button>
            <button class="tab-button" onclick="mudarAba('logs')">
                <i class="fas fa-history"></i> Logs de Edição
            </button>
            <button class="tab-button" onclick="mudarAba('novo-usuario')">
                <i class="fas fa-user-plus"></i> Novo Usuário
            </button>
        </div>

        <!-- Aba de Usuários -->
        <div id="usuarios" class="tab-content active">
            <h2>Gerenciar Usuários</h2>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Tipo</th>
                        <th>Status</th>
                        <th>Data de Criação</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="usersList">
                    <!-- Usuários serão carregados aqui -->
                </tbody>
            </table>
        </div>

        <!-- Aba de Logs -->
        <div id="logs" class="tab-content">
            <h2>Logs de Edição de Orçamentos</h2>
            <div class="logs-container" id="logsList">
                <!-- Logs serão carregados aqui -->
            </div>
        </div>

        <!-- Aba de Novo Usuário -->
        <div id="novo-usuario" class="tab-content">
            <h2>Adicionar Novo Usuário</h2>
            <form id="novoUsuarioForm">
                <div class="form-group">
                    <label for="novoId">ID do Usuário:</label>
                    <input type="text" id="novoId" required placeholder="Digite o ID">
                </div>
                
                <div class="form-group">
                    <label for="novoNome">Nome:</label>
                    <input type="text" id="novoNome" required placeholder="Digite o nome completo">
                </div>
                
                <div class="form-group">
                    <label for="novaSenha">Senha:</label>
                    <input type="password" id="novaSenha" required placeholder="Digite a senha">
                </div>
                
                <div class="form-group">
                    <label for="novoTipo">Tipo:</label>
                    <select id="novoTipo">
                        <option value="FUNCIONARIO">Funcionário</option>
                        <option value="ADM">Administrador</option>
                    </select>
                </div>
                
                <button type="submit" class="btn-primary">
                    <i class="fas fa-user-plus"></i> Adicionar Usuário
                </button>
            </form>
        </div>
    </div>

    <script src="database.js"></script>
    <script>
        // Carregar dados ao iniciar
        window.addEventListener('DOMContentLoaded', function() {
            carregarUsuarios();
            carregarLogs();
        });

        function mudarAba(aba) {
            // Oculta todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active de todos os botões
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostra a aba selecionada
            document.getElementById(aba).classList.add('active');
            
            // Ativa o botão correspondente
            event.target.classList.add('active');
        }

        function carregarUsuarios() {
            const usuarios = listarUsuarios();
            const tbody = document.getElementById('usersList');
            
            tbody.innerHTML = usuarios.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.nome}</td>
                    <td>${user.tipo}</td>
                    <td>${user.ativo ? 'Ativo' : 'Inativo'}</td>
                    <td>${new Date(user.dataCriacao).toLocaleDateString('pt-BR')}</td>
                    <td>
                        ${user.id !== 'ADMnaka' ? 
                            `<button class="btn-danger" onclick="removerUsuario('${user.id}')">
                                <i class="fas fa-trash"></i> Remover
                            </button>` : 
                            '<span style="color: #999;">Principal</span>'
                        }
                    </td>
                </tr>
            `).join('');
        }

        function carregarLogs() {
            const logs = JSON.parse(localStorage.getItem('logDB') || '[]');
            const container = document.getElementById('logsList');
            
            if (logs.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Nenhum log encontrado.</p>';
                return;
            }
            
            container.innerHTML = logs.slice(0, 100).map(log => `
                <div class="log-entry ${log.acao}">
                    <strong>${log.usuario}</strong> - ${log.acao} - ${new Date(log.data).toLocaleString('pt-BR')}
                    <br><small>${log.detalhes}</small>
                </div>
            `).join('');
        }

        function removerUsuario(id) {
            if (!confirm(`Tem certeza que deseja remover o usuário ${id}?`)) {
                return;
            }
            
            const resultado = removerUsuario(id);
            if (resultado.sucesso) {
                alert(resultado.mensagem);
                carregarUsuarios();
            } else {
                alert(resultado.mensagem);
            }
        }

        // Formulário de novo usuário
        document.getElementById('novoUsuarioForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('novoId').value.trim();
            const nome = document.getElementById('novoNome').value.trim();
            const senha = document.getElementById('novaSenha').value;
            const tipo = document.getElementById('novoTipo').value;
            
            if (!id || !nome || !senha) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            
            const resultado = adicionarUsuario(id, senha, nome, tipo);
            
            if (resultado.sucesso) {
                alert(resultado.mensagem);
                this.reset();
                carregarUsuarios();
            } else {
                alert(resultado.mensagem);
            }
        });
    </script>
</body>
</html>